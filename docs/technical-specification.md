# Face Parts Manipulator æŠ€è¡“ä»•æ§˜æ›¸

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#3-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
4. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#4-ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
5. [ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#5-ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
6. [é¡”æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ ](#6-é¡”æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ )
7. [ç”»åƒå¤‰å½¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ](#7-ç”»åƒå¤‰å½¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ )
8. [çŠ¶æ…‹ç®¡ç†](#8-çŠ¶æ…‹ç®¡ç†)
9. [UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#9-uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
10. [ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤](#10-ãƒ“ãƒ«ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºæœ¬æƒ…å ±
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: Face Parts Manipulator
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 7.0.1
- **ç›®çš„**: é¡”ç”»åƒã®å„ãƒ‘ãƒ¼ãƒ„ï¼ˆç›®ãƒ»å£ãƒ»é¼»ãƒ»è¼ªéƒ­ï¼‰ã‚’å€‹åˆ¥ã«æ‹¡å¤§ãƒ»ç¸®å°ãƒ»ç§»å‹•ãƒ»å¤‰å½¢ã™ã‚‹
- **å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€å†™çœŸç·¨é›†æ„›å¥½è€…ã€ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¢ãƒ¼ãƒˆåˆ¶ä½œè€…

### 1.2 ä¸»è¦æ©Ÿèƒ½
1. **é¡”æ¤œå‡º**: face-api.jsã«ã‚ˆã‚‹68ç‚¹é¡”ç‰¹å¾´ç‚¹æ¤œå‡º
2. **ç”»åƒå¤‰å½¢**: Triangle Mesh Forward Mappingã«ã‚ˆã‚‹è‡ªç„¶ãªå¤‰å½¢
3. **ãƒ‘ãƒ¼ãƒ„æ“ä½œ**: ç›®ãƒ»å£ãƒ»é¼»ã®æ‹¡å¤§ãƒ»ç¸®å°ãƒ»ç§»å‹•
4. **ğŸ†• è¼ªéƒ­æ“ä½œ**: é¡”ã®è¼ªéƒ­å½¢çŠ¶ï¼ˆä¸¸ã¿ãƒ»è§’å¼µã‚Šã€é¡ã®å¹…ã€é ¬ã®è†¨ã‚‰ã¿ã€é¡ã®é•·ã•ã€æ»‘ã‚‰ã‹ã•ï¼‰ã®èª¿æ•´
5. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰æ›´ã®å³æ™‚åæ˜ 
6. **ç”»åƒä¿å­˜**: PNG/JPGå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
7. **é«˜åº¦ãªãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ**: æ—¥ä»˜å…ˆé ­ + å…ƒãƒ•ã‚¡ã‚¤ãƒ«å + å…¨å¤‰å½¢è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ 
8. **çµ±åˆå“è³ªè¨­å®š**: é«˜é€Ÿãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼/ãƒãƒ©ãƒ³ã‚¹/æœ€é«˜å“è³ªã®3ãƒ¢ãƒ¼ãƒ‰
9. **UIæœ€é©åŒ–**: ç›´æ„Ÿçš„ã§ç°¡æ½”ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### 1.3 å‹•ä½œè¦ä»¶
- **ãƒ–ãƒ©ã‚¦ã‚¶**: Chrome 90+, Firefox 88+, Safari 14+
- **ç”»é¢è§£åƒåº¦**: 1280x720ä»¥ä¸Šæ¨å¥¨
- **ãƒ¡ãƒ¢ãƒª**: 4GBä»¥ä¸Šæ¨å¥¨

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 å…¨ä½“æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ImageUpload  â”‚  â”‚ImagePreview  â”‚  â”‚ControlPanel   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        çŠ¶æ…‹ç®¡ç†å±¤                         â”‚
â”‚                    Zustand (faceStore)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Face Detectionâ”‚  â”‚Image Warping â”‚  â”‚File Export    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
1. **ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰** â†’ faceStore â†’ é¡”æ¤œå‡º â†’ ç‰¹å¾´ç‚¹æŠ½å‡º
2. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰æ›´** â†’ faceStore â†’ ãƒ¯ãƒ¼ãƒ”ãƒ³ã‚°å‡¦ç† â†’ Canvasæ›´æ–°
3. **ç”»åƒä¿å­˜** â†’ Canvas â†’ Blobå¤‰æ› â†’ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

---

## 3. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 3.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
```json
{
  "react": "^19.0.0",
  "typescript": "~5.6.2",
  "vite": "^7.0.0",
  "@mui/material": "^6.3.1",
  "@emotion/react": "^11.14.0",
  "@emotion/styled": "^11.14.0"
}
```

### 3.2 ç”»åƒå‡¦ç†
```json
{
  "face-api.js": "^0.22.2"
}
```

### 3.3 çŠ¶æ…‹ç®¡ç†
```json
{
  "zustand": "^5.0.2"
}
```

### 3.4 é–‹ç™ºãƒ„ãƒ¼ãƒ«
```json
{
  "@vitejs/plugin-react": "^4.3.4",
  "eslint": "^9.17.0",
  "@types/react": "^19.0.6",
  "@types/react-dom": "^19.0.2"
}
```

---

## 4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ components/          # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ layout/         # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé–¢é€£
â”‚   â”‚   â””â”€â”€ MainLayout.tsx
â”‚   â”œâ”€â”€ panels/         # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«
â”‚   â”‚   â”œâ”€â”€ ControlPanel.tsx
â”‚   â”‚   â”œâ”€â”€ EyeControls.tsx
â”‚   â”‚   â”œâ”€â”€ MouthControls.tsx
â”‚   â”‚   â”œâ”€â”€ NoseControls.tsx
â”‚   â”‚   â””â”€â”€ RenderModeSelector.tsx
â”‚   â””â”€â”€ ui/             # æ±ç”¨UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚       â”œâ”€â”€ ImagePreview.tsx
â”‚       â”œâ”€â”€ ImageUpload.tsx
â”‚       â”œâ”€â”€ ParameterControl.tsx
â”‚       â””â”€â”€ SaveButton.tsx
â”œâ”€â”€ features/           # æ©Ÿèƒ½åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â””â”€â”€ image-warping/  # ç”»åƒå¤‰å½¢æ©Ÿèƒ½
â”‚       â”œâ”€â”€ adaptiveWarping.ts
â”‚       â”œâ”€â”€ anatomicalConstraints.ts
â”‚       â”œâ”€â”€ canvasManager.ts
â”‚       â”œâ”€â”€ forwardMapping/
â”‚       â”‚   â”œâ”€â”€ affineTransform.ts
â”‚       â”‚   â”œâ”€â”€ backwardRenderer.ts
â”‚       â”‚   â”œâ”€â”€ hybridRenderer.ts
â”‚       â”‚   â”œâ”€â”€ meshDeformation.ts
â”‚       â”‚   â””â”€â”€ triangleRenderer.ts
â”‚       â”œâ”€â”€ independentDeformation.ts
â”‚       â””â”€â”€ triangulation/
â”‚           â”œâ”€â”€ delaunay.ts
â”‚           â””â”€â”€ types.ts
â”œâ”€â”€ hooks/              # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useFaceDetection.ts
â”‚   â””â”€â”€ useImageWarping.ts
â”œâ”€â”€ stores/             # çŠ¶æ…‹ç®¡ç†
â”‚   â””â”€â”€ faceStore.ts
â”œâ”€â”€ types/              # å‹å®šç¾©
â”‚   â””â”€â”€ face.ts
â””â”€â”€ utils/              # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â”œâ”€â”€ faceDetection.ts
    â””â”€â”€ fileNameGenerator.ts
```

---

## 5. ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 5.1 ImageUpload ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/ui/ImageUpload.tsx`

**æ©Ÿèƒ½**:
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã«ã‚ˆã‚‹ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼æ¤œè¨¼ (JPG/PNG)
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºæ¤œè¨¼ (8MBä»¥ä¸‹)
- è§£åƒåº¦æ¤œè¨¼ (1920pxä»¥ä¸‹)

**ä¸»è¦Props**: ãªã—ï¼ˆZustandã‚¹ãƒˆã‚¢ã‚’ç›´æ¥å‚ç…§ï¼‰

**çŠ¶æ…‹ç®¡ç†**:
```typescript
const { setOriginalImage, resetAll } = useFaceStore();
```

### 5.2 ImagePreview ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/ui/ImagePreview.tsx`

**æ©Ÿèƒ½**:
- å…ƒç”»åƒã¨ç·¨é›†å¾Œç”»åƒã®ä¸¦åˆ—è¡¨ç¤º
- Canvasè¦ç´ ã®ç®¡ç†
- ç‰¹å¾´ç‚¹ã®å¯è¦–åŒ–ï¼ˆãƒˆã‚°ãƒ«å¯èƒ½ï¼‰
- å“è³ªè¨­å®šã®é¸æŠ

**Canvasç®¡ç†**:
```typescript
const originalCanvasRef = useRef<HTMLCanvasElement>(null);
const fabricCanvasRef = useRef<HTMLCanvasElement>(null);
```

### 5.3 ControlPanel ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/panels/ControlPanel.tsx`

**æ©Ÿèƒ½**:
- ã‚¿ãƒ–ã«ã‚ˆã‚‹ãƒ‘ãƒ¼ãƒ„åˆ‡ã‚Šæ›¿ãˆï¼ˆç›®ãƒ»å£ãƒ»é¼»ï¼‰
- å…¨ä½“ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰é¸æŠ
- æ“ä½œèª¬æ˜ã®è¡¨ç¤º

**ã‚¿ãƒ–æ§‹æˆ**:
- Tab 0: ç›®ã®èª¿æ•´
- Tab 1: å£ã®èª¿æ•´  
- Tab 2: é¼»ã®èª¿æ•´

---

## 6. é¡”æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ 

### 6.1 face-api.js åˆæœŸåŒ–
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/utils/faceDetection.ts`

**ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿**:
```typescript
await faceapi.nets.tinyFaceDetector.loadFromUri('/models');
await faceapi.nets.faceLandmark68Net.loadFromUri('/models');
```

**å¿…è¦ãªãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«**:
- `tiny_face_detector_model-shard1`
- `tiny_face_detector_model-weights_manifest.json`
- `face_landmark_68_model-shard1`
- `face_landmark_68_model-weights_manifest.json`

### 6.2 é¡”æ¤œå‡ºå‡¦ç†
**æ¤œå‡ºã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
```typescript
const options = new faceapi.TinyFaceDetectorOptions({
  inputSize: 416,
  scoreThreshold: 0.5
});
```

### 6.3 ç‰¹å¾´ç‚¹ã®åˆ†é¡
68å€‹ã®ç‰¹å¾´ç‚¹ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†é¡:
- **é¡ãƒ©ã‚¤ãƒ³**: 0-16 (17ç‚¹)
- **å·¦çœ‰æ¯›**: 17-21 (5ç‚¹)
- **å³çœ‰æ¯›**: 22-26 (5ç‚¹)
- **é¼»ç­‹**: 27-30 (4ç‚¹)
- **é¼»ä¸‹éƒ¨**: 31-35 (5ç‚¹)
- **å·¦ç›®**: 36-41 (6ç‚¹)
- **å³ç›®**: 42-47 (6ç‚¹)
- **å£å¤–å´**: 48-59 (12ç‚¹)
- **å£å†…å´**: 60-67 (8ç‚¹)

---

## 7. ç”»åƒå¤‰å½¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### 7.1 Triangle Mesh Forward Mapping
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/image-warping/forwardMapping/meshDeformation.ts`

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. Delaunayä¸‰è§’åˆ†å‰²ã«ã‚ˆã‚‹é¡”ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆ
2. åˆ¶å¾¡ç‚¹ã®ç”Ÿæˆã¨ç§»å‹•è¨ˆç®—
3. ã‚¢ãƒ•ã‚£ãƒ³å¤‰æ›ã«ã‚ˆã‚‹ä¸‰è§’å½¢å˜ä½ã®å¤‰å½¢
4. ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³æ³•ã«ã‚ˆã‚‹ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

### 7.2 Delaunayä¸‰è§’åˆ†å‰²
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/image-warping/triangulation/delaunay.ts`

**ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **:
```typescript
export function delaunayTriangulation(points: Point[]): Triangle[] {
  // 1. ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«ã®ä½œæˆ
  // 2. ç‚¹ã®é€æ¬¡æŒ¿å…¥
  // 3. Bowyer-Watson ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
  // 4. ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«ã®é™¤å»
}
```

**æœ€é©åŒ–**:
- 68å€‹ã®é¡”ç‰¹å¾´ç‚¹ + 28å€‹ã®å¢ƒç•Œç‚¹ = 96ç‚¹
- ç´„163å€‹ã®ä¸‰è§’å½¢ã‚’ç”Ÿæˆ

### 7.3 åˆ¶å¾¡ç‚¹ã‚·ã‚¹ãƒ†ãƒ 
**ç›®ã®åˆ¶å¾¡** (3å±¤æ§‹é€ ):
1. **è¼ªéƒ­åˆ¶å¾¡ç‚¹** (weight: 1.0) - ç›®ã®å¤–å½¢
2. **ç³å­”ä¸­å¿ƒå›ºå®š** (weight: 1.5) - å®Œå…¨å›ºå®š
3. **è™¹å½©å¢ƒç•Œåˆ¶å¾¡** (weight: 1.2) - å††å½¢ä¿æŒ

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¯„å›²**:
```typescript
const PARAM_LIMITS = {
  eye: {
    size: { min: 0.2, max: 4.0, step: 0.01, default: 1.0 },
    positionX: { min: -50, max: 50, step: 1, default: 0 },
    positionY: { min: -50, max: 50, step: 1, default: 0 }
  },
  mouth: {
    width: { min: 0.2, max: 4.0, step: 0.01, default: 1.0 },
    height: { min: 0.2, max: 4.0, step: 0.01, default: 1.0 },
    positionX: { min: -80, max: 80, step: 1, default: 0 },
    positionY: { min: -80, max: 80, step: 1, default: 0 }
  },
  nose: {
    width: { min: 0.3, max: 3.0, step: 0.01, default: 1.0 },
    height: { min: 0.3, max: 3.0, step: 0.01, default: 1.0 },
    positionX: { min: -40, max: 40, step: 1, default: 0 },
    positionY: { min: -40, max: 40, step: 1, default: 0 }
  }
};
```

### 7.4 ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰

#### Forward Rendering (é«˜é€Ÿ)
```typescript
// ã‚½ãƒ¼ã‚¹ä¸‰è§’å½¢ â†’ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¸‰è§’å½¢ã¸ã®ç›´æ¥ãƒãƒƒãƒ”ãƒ³ã‚°
// å‡¦ç†æ™‚é–“: ~100ms
```

#### Backward Rendering (é«˜å“è³ª)
```typescript
// ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ”ã‚¯ã‚»ãƒ« â†’ ã‚½ãƒ¼ã‚¹ãƒ”ã‚¯ã‚»ãƒ«ã¸ã®é€†ç®—
// å‡¦ç†æ™‚é–“: ~2000ms
```

#### Hybrid Rendering (ãƒãƒ©ãƒ³ã‚¹å‹)
```typescript
// ã‚¨ãƒƒã‚¸éƒ¨åˆ†ã®ã¿Backwardã€å†…éƒ¨ã¯Forward
// å‡¦ç†æ™‚é–“: ~300ms
// ã‚¨ãƒƒã‚¸å¹…: 20px (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
```

---

## 8. çŠ¶æ…‹ç®¡ç†

### 8.1 Zustand Storeæ§‹é€ 
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/stores/faceStore.ts`

```typescript
interface FaceStore {
  // ç”»åƒé–¢é€£
  originalImage: ImageData | null;
  processedImageUrl: string | null;
  
  // é¡”æ¤œå‡ºé–¢é€£
  faceDetection: FaceDetectionResult | null;
  isDetecting: boolean;
  
  // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  faceParams: FaceParams;
  
  // å‡¦ç†çŠ¶æ…‹
  isProcessing: boolean;
  renderMode: 'forward' | 'backward' | 'hybrid';
  
  // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š
  exportSettings: {
    format: 'png' | 'jpg';
    jpgQuality: number;
  };
  
  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  setOriginalImage: (imageData: ImageData) => void;
  setFaceDetection: (result: FaceDetectionResult | null) => void;
  updateEyeParams: (eye: 'left' | 'right', params: Partial<EyeParams>) => void;
  updateMouthParams: (params: Partial<MouthParams>) => void;
  updateNoseParams: (params: Partial<NoseParams>) => void;
  updateContourParams: (params: Partial<ContourParams>) => void; // ğŸ†• è¼ªéƒ­ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°
  resetParams: () => void;
  resetAll: () => void;
}
```

### 8.2 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°ã®æœ€é©åŒ–
```typescript
// éƒ¨åˆ†æ›´æ–°ã«ã‚ˆã‚‹å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€å°åŒ–
updateEyeParams: (eye, params) => set((state) => ({
  faceParams: {
    ...state.faceParams,
    [eye === 'left' ? 'leftEye' : 'rightEye']: {
      ...state.faceParams[eye === 'left' ? 'leftEye' : 'rightEye'],
      ...params
    }
  }
}))
```

---

## 9. è¼ªéƒ­æ“ä½œã‚·ã‚¹ãƒ†ãƒ 

### 9.1 è¼ªéƒ­ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾©
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/types/face.ts`

```typescript
export interface ContourParams {
  roundness: number;      // -1.0ã€œ1.0 (è² : è§’å¼µã‚Š, æ­£: ä¸¸ã¿)
  jawWidth: number;       // 0.7ã€œ1.3 (é¡ã®å¹…)
  cheekFullness: number;  // 0.7ã€œ1.3 (é ¬ã®è†¨ã‚‰ã¿)
  chinHeight: number;     // 0.8ã€œ1.2 (é¡ã®é•·ã•)
  smoothness: number;     // 0.0ã€œ1.0 (è¼ªéƒ­ã®æ»‘ã‚‰ã‹ã•)
}
```

### 9.2 è¼ªéƒ­å¤‰å½¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/image-warping/contourDeformation.ts`

#### 9.2.1 åˆ¶å¾¡ç‚¹ç”Ÿæˆãƒ—ãƒ­ã‚»ã‚¹
1. **Jawlineåˆ†æ**: 68ç‚¹ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã®0-16ç•ªï¼ˆé¡ã®è¼ªéƒ­ç·šï¼‰ã‚’åŸºæº–ã¨ã™ã‚‹
2. **é ˜åŸŸåˆ†é¡**: 
   - ä¸‹é¡éƒ¨ (index 3-13): ä¸»ã«ä¸¸ã¿ãƒ»è§’å¼µã‚Šã€é¡ã®é•·ã•ã«å½±éŸ¿
   - å´é¢éƒ¨ (index 0-4, 12-16): ä¸»ã«é¡ã®å¹…ã«å½±éŸ¿
   - é ¬éƒ¨ (index 1-3, 13-15): ä¸»ã«é ¬ã®è†¨ã‚‰ã¿ã«å½±éŸ¿

#### 9.2.2 å¤‰å½¢è¨ˆç®—
```typescript
// 1. roundness: ä¸¸ã¿â‡”è§’å¼µã‚Š
if (params.roundness !== 0) {
  if (isLowerJaw) {
    const roundnessEffect = params.roundness * 0.1;
    dx += relX * roundnessEffect;
    // ä¸¸ã¿ã®å ´åˆã¯é¡å…ˆã‚’å°‘ã—ä¸Šã’ã‚‹
    if (params.roundness > 0 && (index === 8 || index === 9)) {
      dy -= faceHeight * params.roundness * 0.02;
    }
  }
}

// 2. jawWidth: é¡ã®å¹…
if (params.jawWidth !== 1.0 && isSideJaw) {
  const widthEffect = (params.jawWidth - 1.0);
  dx += relX * widthEffect * 0.5;
}

// 3. cheekFullness: é ¬ã®è†¨ã‚‰ã¿
if (params.cheekFullness !== 1.0 && isCheekArea) {
  const fullnessEffect = (params.cheekFullness - 1.0);
  dx += Math.sign(relX) * faceWidth * fullnessEffect * 0.1;
  dy += faceHeight * fullnessEffect * 0.02;
}

// 4. chinHeight: é¡ã®é•·ã•
if (params.chinHeight !== 1.0 && isLowerJaw) {
  const heightEffect = (params.chinHeight - 1.0);
  const centerRatio = 1 - Math.abs(lowerJawRatio - 0.5) * 2;
  dy += faceHeight * heightEffect * centerRatio * 0.15;
}
```

#### 9.2.3 å¹³æ»‘åŒ–å‡¦ç†
```typescript
// smoothnessãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚ˆã‚‹å¾Œå‡¦ç†
if (params.smoothness > 0) {
  const iterations = Math.round(params.smoothness * 5);
  // 3ç‚¹é‡ã¿ä»˜ãå¹³å‡ã«ã‚ˆã‚‹è¼ªéƒ­ç·šå¹³æ»‘åŒ–
  for (let iter = 0; iter < iterations; iter++) {
    // éš£æ¥ç‚¹ã¨ã®é‡ã¿ä»˜ãå¹³å‡è¨ˆç®—
  }
}
```

### 9.3 ãƒ¡ãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹çµ±åˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/features/image-warping/forwardMapping/meshDeformation.ts`

è¼ªéƒ­å¤‰å½¢ã¯æ—¢å­˜ã®ãƒ¡ãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹å¤‰å½¢ã‚·ã‚¹ãƒ†ãƒ ã«çµ±åˆã•ã‚Œã¦ãŠã‚Šã€ä»¥ä¸‹ã®æµã‚Œã§å‡¦ç†ã•ã‚Œã‚‹ï¼š

1. **ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯å¤‰å½¢**: `deformLandmarks()`é–¢æ•°ã§è¼ªéƒ­ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é©ç”¨
2. **æ¡ä»¶ä»˜ãå®Ÿè¡Œ**: `isContourChangeDetected()`ã§å¤‰æ›´æ¤œçŸ¥
3. **åˆ¶å¾¡ç‚¹ç”Ÿæˆ**: `generateContourControlPoints()`ã§å¤‰å½¢åˆ¶å¾¡ç‚¹ã‚’ç”Ÿæˆ
4. **Jawlineæ›´æ–°**: å¤‰å½¢å¾Œã®åˆ¶å¾¡ç‚¹ã§jawlineã‚’ç›´æ¥æ›´æ–°
5. **ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆ**: æ›´æ–°ã•ã‚ŒãŸãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã§ä¸‰è§’å½¢ãƒ¡ãƒƒã‚·ãƒ¥ã‚’æ§‹ç¯‰

### 9.4 UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/panels/ContourControls.tsx`

- **ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‚¿ãƒ–**: "ğŸ”· è¼ªéƒ­æ“ä½œ"ã¨ã—ã¦ç‹¬ç«‹ã—ãŸã‚¿ãƒ–
- **5ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ¶å¾¡**: ParameterControlã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨
- **ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½**: å€‹åˆ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨å…¨ä½“ãƒªã‚»ãƒƒãƒˆ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰æ›´ã®å³åº§åæ˜ 

---

## 10. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 9.1 ParameterControl
**å…±é€šã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

Props:
```typescript
interface ParameterControlProps {
  label: string;
  value: number;
  min: number;
  max: number;
  step: number;
  unit?: string;
  onChange: (value: number) => void;
  onReset?: () => void;
  disabled?: boolean;
}
```

æ©Ÿèƒ½:
- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨æ•°å€¤å…¥åŠ›ã®é€£å‹•
- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- å€¤ã®æ¤œè¨¼ã¨ã‚¯ãƒ©ãƒ³ãƒ—

### 9.2 SaveButton
**ç”»åƒä¿å­˜æ©Ÿèƒ½**

å‡¦ç†ãƒ•ãƒ­ãƒ¼:
1. Canvasè¦ç´ ã‹ã‚‰Blobã‚’ç”Ÿæˆ
2. ãƒ•ã‚¡ã‚¤ãƒ«åã®è‡ªå‹•ç”Ÿæˆï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—+ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
3. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã®ä½œæˆã¨è‡ªå‹•ã‚¯ãƒªãƒƒã‚¯
4. Snackbarã«ã‚ˆã‚‹å®Œäº†é€šçŸ¥

ãƒ•ã‚¡ã‚¤ãƒ«åå½¢å¼:
```
face-edit-YYYYMMDD-HHMMSS-[eye2.0x]-[mouth1.5x].png
```

### 9.3 RenderModeSelector
**ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰é¸æŠ**

é¸æŠè‚¢:
- Forward (æœ€é€Ÿ): ~100ms
- Hybrid (æ¨å¥¨): ~300ms  
- Backward (æœ€é«˜å“è³ª): ~2000ms

---

## 10. ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

### 10.1 é–‹ç™ºç’°å¢ƒ
```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev  # http://localhost:5173

# TypeScriptãƒã‚§ãƒƒã‚¯
npm run tsc
```

### 10.2 ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
```bash
# ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
npm run build

# å‡ºåŠ›å…ˆ: dist/
# - index.html
# - assets/
#   - index-[hash].js
#   - index-[hash].css
# - models/ (face-api.jsãƒ¢ãƒ‡ãƒ«)
```

### 10.3 ç’°å¢ƒè¦ä»¶
- Node.js: 18.0.0ä»¥ä¸Š
- npm: 9.0.0ä»¥ä¸Š

### 10.4 ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã§é…ä¿¡å¯èƒ½:
- Vercel
- Netlify  
- GitHub Pages
- AWS S3 + CloudFront

**é‡è¦**: `/models/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

## ä»˜éŒ²A: ä¸»è¦ãªå‹å®šç¾©

```typescript
// é¡”ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
interface FaceParams {
  leftEye: EyeParams;
  rightEye: EyeParams;
  mouth: MouthParams;
  nose: NoseParams;
}

// ãƒ‘ãƒ¼ãƒ„åˆ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
interface EyeParams {
  size: number;      // 0.2-4.0
  positionX: number; // -50 to +50
  positionY: number; // -50 to +50
}

interface MouthParams {
  width: number;     // 0.2-4.0
  height: number;    // 0.2-4.0
  positionX: number; // -80 to +80
  positionY: number; // -80 to +80
}

interface NoseParams {
  width: number;     // 0.3-3.0
  height: number;    // 0.3-3.0
  positionX: number; // -40 to +40
  positionY: number; // -40 to +40
}

// é¡”æ¤œå‡ºçµæœ
interface FaceDetectionResult {
  isDetected: boolean;
  confidence: number;
  landmarks: FaceLandmarks;
  bounds: FaceBounds;
  centers: FaceCenters;
}

// ä¸‰è§’å½¢ãƒ¡ãƒƒã‚·ãƒ¥
interface Triangle {
  vertices: [Point, Point, Point];
}

interface Point {
  x: number;
  y: number;
}
```

---

## ä»˜éŒ²B: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å‰Šæ¸›
1. Canvasè¦ç´ ã®é©åˆ‡ãªã‚µã‚¤ã‚ºè¨­å®š
2. ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®é˜²æ­¢
3. ç”»åƒãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

### å‡¦ç†é€Ÿåº¦å‘ä¸Š
1. ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã«ã‚ˆã‚‹å‡¦ç†ç¯„å›²é™å®š
2. ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³æ³•ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚º
3. Web Workersã®æ´»ç”¨ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

### ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºæœ€é©åŒ–
1. Tree-shakingã«ã‚ˆã‚‹æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰å‰Šé™¤
2. å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ¤œè¨ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
3. ç”»åƒã‚¢ã‚»ãƒƒãƒˆã®æœ€é©åŒ–

---

ã“ã®ä»•æ§˜æ›¸ã¯ Version 5.2.2 æ™‚ç‚¹ã®æƒ…å ±ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚
æœ€çµ‚æ›´æ–°æ—¥: 2025å¹´1æœˆ4æ—¥
# 顔パーツ操作Webアプリ 開発TODOリスト

## 📋 プロジェクト概要
- **目的**: 顔の特徴点を検出し、顔パーツ（目・口・鼻）をワーピングで操作するWebアプリ
- **技術スタック**: React + TypeScript + Vite + face-api.js + fabric.js
- **対象パーツ**: 目（左右個別）・口・鼻
- **操作方法**: リアルタイムプレビュー、スライダー+数値入力

## 🚀 Phase 1: プロジェクト基盤構築

### 1.1 環境セットアップ
- [ ] Vite + React + TypeScript プロジェクト作成
- [ ] 必要なライブラリのインストール
  - [ ] `@mui/material @emotion/react @emotion/styled` (UI)
  - [ ] `face-api.js` (顔検出)
  - [ ] `fabric` (画像操作)
  - [ ] `zustand` (状態管理)
  - [ ] `@types/fabric` (TypeScript型定義)
- [ ] プロジェクト構造の作成
  - [ ] `src/components/` (React コンポーネント)
  - [ ] `src/hooks/` (カスタムフック)
  - [ ] `src/utils/` (ユーティリティ関数)
  - [ ] `src/types/` (TypeScript型定義)
  - [ ] `src/stores/` (状態管理)
  - [ ] `public/models/` (face-api.js モデルファイル)

### 1.2 基本コンポーネント作成
- [ ] メインレイアウトコンポーネント (`MainLayout.tsx`)
  - [ ] 横並びレイアウト（画像エリア｜制御パネル）
- [ ] 画像アップロードコンポーネント (`ImageUpload.tsx`)
  - [ ] ドラッグ&ドロップ対応
  - [ ] ファイル形式検証 (JPG/PNG)
  - [ ] ファイルサイズ検証 (8MB以下)
  - [ ] 解像度検証 (1920px以下)
- [ ] 画像プレビューコンポーネント (`ImagePreview.tsx`)
  - [ ] 左右比較表示 (元画像｜編集後)
  - [ ] Canvas要素の配置

## 🎯 Phase 2: 顔検出機能実装

### 2.1 face-api.js セットアップ
- [ ] face-api.js モデルファイルの配置
  - [ ] `tiny_face_detector_model` (軽量顔検出)
  - [ ] `face_landmark_68_model` (68個特徴点)
- [ ] 顔検出サービス作成 (`faceDetection.ts`)
  - [ ] モデル読み込み処理
  - [ ] 顔検出処理
  - [ ] 68個特徴点の取得
  - [ ] エラーハンドリング
- [ ] 顔検出フック作成 (`useFaceDetection.ts`)
  - [ ] 検出状態管理
  - [ ] 特徴点データの保存

### 2.2 特徴点データ構造定義
- [ ] TypeScript型定義 (`types/face.ts`)
```typescript
interface FaceLandmarks {
  leftEye: Point[]      // 特徴点 36-41
  rightEye: Point[]     // 特徴点 42-47
  mouth: Point[]        // 特徴点 48-67
  nose: Point[]         // 特徴点 27-35
}

interface FaceParams {
  leftEye: { size: number; positionX: number; positionY: number }
  rightEye: { size: number; positionX: number; positionY: number }
  mouth: { width: number; height: number; positionX: number; positionY: number }
  nose: { width: number; height: number; positionX: number; positionY: number }
}
```

## 🎨 Phase 3: UI制御パネル実装

### 3.1 制御パネルコンポーネント
- [ ] メインパネル (`ControlPanel.tsx`)
  - [ ] タブ構成 (目・口・鼻)
  - [ ] Material-UI Tabs使用
- [ ] 目制御タブ (`EyeControls.tsx`)
  - [ ] 左目制御セクション
    - [ ] 大きさスライダー (0.5-2.0, step: 0.05)
    - [ ] X位置スライダー (-20 to +20)
    - [ ] Y位置スライダー (-20 to +20)
    - [ ] 各パラメータの数値入力
    - [ ] 個別リセットボタン
  - [ ] 右目制御セクション（同様）
- [ ] 口制御タブ (`MouthControls.tsx`)
  - [ ] 幅スライダー (0.5-2.0, step: 0.05)
  - [ ] 高さスライダー (0.5-2.0, step: 0.05)
  - [ ] X位置スライダー (-30 to +30)
  - [ ] Y位置スライダー (-30 to +30)
  - [ ] 数値入力 + 個別リセット
- [ ] 鼻制御タブ (`NoseControls.tsx`)
  - [ ] 幅スライダー (0.7-1.5, step: 0.05)
  - [ ] 高さスライダー (0.7-1.5, step: 0.05)
  - [ ] X位置スライダー (-15 to +15)
  - [ ] Y位置スライダー (-15 to +15)
  - [ ] 数値入力 + 個別リセット

### 3.2 パラメータ制御システム
- [ ] 状態管理ストア (`stores/faceStore.ts`)
  - [ ] 顔パラメータの管理
  - [ ] リアルタイム更新処理
  - [ ] 個別リセット機能
- [ ] パラメータ更新フック (`useParamsUpdate.ts`)
  - [ ] スライダー変更時の処理
  - [ ] 数値入力時の処理
  - [ ] リアルタイムプレビュー連携

## 🖼️ Phase 4: 画像ワーピング実装

### 4.1 fabric.js セットアップ
- [ ] Canvas初期化処理 (`canvas/canvasSetup.ts`)
  - [ ] fabric.Canvas 作成
  - [ ] 画像読み込み処理
  - [ ] Canvas サイズ調整
- [ ] 基本画像操作 (`canvas/imageOperations.ts`)
  - [ ] 画像のCanvas配置
  - [ ] 画像の中央配置
  - [ ] アスペクト比保持

### 4.2 ワーピング処理（Phase 1: 基本変形）
- [ ] 目のワーピング (`warping/eyeWarping.ts`)
  - [ ] 特徴点からの領域抽出
  - [ ] スケール変形処理
  - [ ] 位置移動処理
  - [ ] 左右個別処理
- [ ] 口のワーピング (`warping/mouthWarping.ts`)
  - [ ] 特徴点からの領域抽出
  - [ ] 幅・高さ変形処理
  - [ ] 位置移動処理
- [ ] 鼻のワーピング (`warping/noseWarping.ts`)
  - [ ] 特徴点からの領域抽出
  - [ ] 幅・高さ変形処理
  - [ ] 位置移動処理

### 4.3 リアルタイムプレビュー
- [ ] プレビュー更新システム (`preview/previewSystem.ts`)
  - [ ] パラメータ変更時の自動更新
  - [ ] 変形処理の最適化
  - [ ] レンダリング性能向上
- [ ] プレビューフック (`usePreview.ts`)
  - [ ] 変形処理の実行
  - [ ] Canvas更新の管理
  - [ ] エラーハンドリング

## 💾 Phase 5: 画像保存機能

### 5.1 保存機能実装
- [ ] 保存オプション選択 (`SaveOptions.tsx`)
  - [ ] 形式選択 (オリジナル/PNG/JPG)
  - [ ] 品質設定表示（JPGの場合）
  - [ ] ファイル名設定
- [ ] 画像エクスポート (`export/imageExport.ts`)
  - [ ] Canvas to Blob変換
  - [ ] ファイル形式変換
  - [ ] ダウンロード処理
- [ ] 保存ボタン (`SaveButton.tsx`)
  - [ ] 保存処理の実行
  - [ ] プログレス表示
  - [ ] 成功/失敗メッセージ

## 🛠️ Phase 6: エラーハンドリング・最適化

### 6.1 エラーハンドリング
- [ ] 画像アップロードエラー
  - [ ] 形式不正エラー
  - [ ] サイズ超過エラー
  - [ ] 解像度超過エラー
- [ ] 顔検出エラー
  - [ ] 顔が検出されない場合
  - [ ] 複数の顔が検出された場合
  - [ ] 特徴点取得失敗
- [ ] 処理エラー
  - [ ] ワーピング処理エラー
  - [ ] Canvas操作エラー
  - [ ] 保存処理エラー

### 6.2 パフォーマンス最適化
- [ ] 画像処理の最適化
  - [ ] 大きな画像の自動リサイズ
  - [ ] 処理済みキャッシュ
  - [ ] メモリ使用量の最適化
- [ ] UIの最適化
  - [ ] スライダー操作の遅延処理
  - [ ] 不要な再レンダリング防止
  - [ ] ローディング状態の改善

## 🎨 Phase 7: UI/UX改善

### 7.1 ユーザビリティ向上
- [ ] 初回利用ガイド
  - [ ] 使い方の説明
  - [ ] サンプル画像の提供
  - [ ] 操作手順の案内
- [ ] 視覚的フィードバック
  - [ ] 処理中インジケーター
  - [ ] 成功/失敗メッセージ
  - [ ] 特徴点の視覚化（オプション）

### 7.2 レスポンシブデザイン
- [ ] PC表示の最適化
  - [ ] 各画面サイズでの表示確認
  - [ ] 制御パネルの幅調整
  - [ ] 画像表示の最適化

## 🧪 Phase 8: テスト・検証

### 8.1 機能テスト
- [ ] 各パーツの変形テスト
- [ ] 境界値テスト（最小・最大値）
- [ ] エラーケーステスト
- [ ] 保存機能テスト

### 8.2 パフォーマンステスト
- [ ] 大きな画像での処理速度
- [ ] メモリ使用量の確認
- [ ] 複数操作時の安定性

## 📚 Phase 9: ドキュメント・完成

### 9.1 ドキュメント作成
- [ ] README.md作成
- [ ] API仕様書
- [ ] 操作マニュアル

### 9.2 最終調整
- [ ] 全体的な動作確認
- [ ] バグ修正
- [ ] UI調整

## 🔮 Phase 10: 将来の拡張機能（オプション）

### 10.1 高度な機能
- [ ] 眉毛の調整
- [ ] 輪郭の調整
- [ ] 目の角度調整
- [ ] 口角の調整

### 10.2 追加機能
- [ ] プリセット機能
- [ ] 編集履歴機能
- [ ] 複数顔対応
- [ ] 動画対応

---

## 📊 優先度と所要時間見積もり

| Phase | 優先度 | 所要時間 | 説明 |
|--------|--------|----------|------|
| Phase 1 | 🔴 高 | 4-6時間 | 基盤構築 |
| Phase 2 | 🔴 高 | 6-8時間 | 顔検出 |
| Phase 3 | 🔴 高 | 8-10時間 | UI制御 |
| Phase 4 | 🔴 高 | 10-12時間 | ワーピング |
| Phase 5 | 🟡 中 | 4-6時間 | 保存機能 |
| Phase 6 | 🟡 中 | 6-8時間 | エラー処理 |
| Phase 7 | 🟢 低 | 4-6時間 | UI改善 |
| Phase 8 | 🟢 低 | 4-6時間 | テスト |
| Phase 9 | 🟢 低 | 2-4時間 | ドキュメント |
| Phase 10 | 🔵 オプション | 10-20時間 | 拡張機能 |

**合計見積もり時間**: 58-86時間 （コア機能のみ: 38-52時間）

## 🎯 次のステップ

1. **Phase 1** から順番に実装を開始
2. 各Phase完了後に動作確認
3. 問題があれば前のPhaseに戻って修正
4. 最小限の機能でまず動作するものを完成させる
5. 段階的に機能を追加していく 